---
name  :  mac_client_task
type  :  task
agent  :  CodeActAgent
---

# OpenHands Mac Client Comprehensive Specification

## 1. Core App Features

The Mac client will include the following core features:

1.  **Task Input Area:**
    *   Description: A text area where users can input instructions and tasks for OpenHands.
    *   Functionality: Accepts natural language task instructions.
    *   Implementation Requirements:
        *   Support for text formatting (optional)
        *   Image attachment capability (optional for MVP)
        *   Command history (optional for MVP)

2.  **Agent Output Display:**
    *   Description: A window or panel to display the step-by-step actions, logs, and outputs generated by the OpenHands agent.
    *   Functionality: Real-time display of agent's progress, including code changes and command executions.
    *   Implementation Requirements:
        *   Support for multiple output types (text, markdown, code, terminal, images)
        *   Syntax highlighting for code blocks
        *   Auto-scrolling with manual override
        *   Chunked processing for large outputs

3.  **File Explorer:**
    *   Description: A file tree view to browse and manage files within the workspace.
    *   Functionality: File system navigation, file opening, basic file management.
    *   Implementation Requirements:
        *   Read-only view for MVP (create, delete, rename optional)
        *   Lazy loading of directory contents
        *   File content caching for performance
        *   Support for viewing different file types

4.  **Control Buttons:**
    *   Description: Buttons to control the agent's execution state.
    *   Functionality: Start, stop, and pause agent execution.
    *   Implementation Requirements:
        *   Visual indication of current agent state
        *   Confirmation for potentially destructive actions
        *   Keyboard shortcuts (optional for MVP)

5.  **Conversation Management:**
    *   Description: Interface to create, switch between, and manage multiple conversations.
    *   Functionality:
        *   Create new conversations with different agent types
        *   Switch between existing conversations via tabs or sidebar
        *   Rename conversations for better organization
        *   Delete conversations with confirmation dialog
        *   View and search conversation history
        *   Export conversation logs for sharing or archiving
        *   Group conversations by project or topic
        *   Filter conversations by status, date, or agent type
        *   Pin important conversations for quick access
    *   Implementation Requirements:
        *   Intuitive UI for conversation switching (tabs or sidebar)
        *   Visual indicators for conversation status (active, paused, completed)
        *   Confirmation dialogs for destructive actions
        *   Search functionality within conversation history
        *   Keyboard shortcuts for quick conversation switching
        *   Persistent storage of conversation list and metadata
        *   Ability to restore previous conversation state
        *   Conversation tagging and categorization
        *   Bulk operations for managing multiple conversations
        *   Conversation statistics and usage metrics

6.  **Settings Panel:**
    *   Description: A comprehensive tabbed panel to configure all settings for the Mac client and the OpenHands backend, matching all options in backend config.template.toml.
    *   Functionality:
        *   General Settings:
            *   UI theme (light/dark/system)
            *   Font size and family
            *   Display preferences
            *   Keyboard shortcuts
            *   Notification preferences
            *   Startup behavior
        *   Backend Connection:
            *   Local or remote backend URL
            *   Authentication settings
            *   Connection timeout and retry settings
            *   Proxy configuration
            *   WebSocket parameters
            *   Health check settings
        *   Model Settings:
            *   LLM provider selection
            *   Model selection (GPT-4, Claude, etc.)
            *   Context length configuration
            *   Temperature and other sampling parameters
            *   System prompt customization
            *   Model fallback options
            *   Caching parameters
        *   API Keys:
            *   Secure storage for provider API keys
            *   Key validation and status indicators
            *   Usage tracking and quotas
            *   Rotation policies
            *   Environment variable integration
        *   Execution Settings:
            *   Timeout configurations
            *   Rate limiting settings
            *   Parallel execution options
            *   Error handling preferences
            *   Tool execution parameters
            *   Memory management
        *   File System:
            *   Default workspace location
            *   File browser preferences
            *   File type associations
            *   Ignored files and patterns
            *   File watching settings
            *   Version control integration
        *   Advanced:
            *   Logging level and location
            *   Debug options
            *   Performance tuning
            *   Experimental features
            *   Developer tools
            *   Diagnostic information
    *   Implementation Requirements:
        *   Tabbed interface with logical grouping of settings
        *   Search functionality to quickly find specific settings
        *   Import/export functionality for settings backup
        *   Real-time validation of setting values
        *   Clear documentation for each setting with tooltips
        *   Persistent storage of settings
        *   Secure storage of sensitive information
        *   Default value indicators
        *   Reset to defaults option
        *   Settings change history
        *   Profile-based settings management

## 2. Backend Integration

### 2.1 Socket.IO Communication

*   **Connection Management:**
    *   Establish and maintain WebSocket connection to backend
    *   Handle reconnection with exponential backoff
    *   Support authentication via tokens
    *   Monitor connection health

*   **Event Handling:**
    *   Process `oh_event` messages from backend
    *   Send `oh_action` messages to backend
    *   Handle different event types (system, agent, file, etc.)
    *   Implement event queueing for offline scenarios (optional for MVP)

*   **Specific Events to Support:**
    *   Agent state changes (running, paused, stopped)
    *   Command execution and results
    *   File operations and updates
    *   Error notifications
    *   Authentication events

### 2.2 REST API Integration

*   **Conversation Management:**
    *   Create new conversations
    *   List existing conversations
    *   Update conversation details
    *   Delete conversations

*   **File Operations:**
    *   List files in workspace
    *   Get file content
    *   Save file content (optional for MVP)
    *   Upload files (optional for MVP)

*   **Settings Management:**
    *   Load application settings
    *   Store application settings

*   **Configuration:**
    *   Get available models
    *   Get available agents
    *   Get server configuration

## 3. User Interface Flow

### 3.1 Main Application Flow

1.  **Startup:**
    *   Load saved settings
    *   Connect to backend
    *   Show conversation list or create new conversation

2.  **Conversation Creation:**
    *   Select agent type
    *   Provide initial task description
    *   Initialize conversation with backend

3.  **Conversation Interaction:**
    *   Display agent outputs in real-time
    *   Allow user to input additional instructions
    *   Control agent execution (start, stop, pause)
    *   Browse workspace files

4.  **Settings Access:**
    *   Access settings from main interface
    *   Apply settings changes immediately where possible

### 3.2 UI Components and Layout

*   **Main Window:**
    *   Split view with resizable panels
    *   File explorer on left side
    *   Chat/output display in center
    *   Task input at bottom
    *   Control buttons in toolbar

*   **Settings Window:**
    *   Modal dialog or separate window
    *   Categorized settings
    *   Save/cancel buttons

*   **Error Notifications:**
    *   Non-intrusive notifications for minor errors
    *   Modal dialogs for critical errors
    *   Recovery options where applicable

## 4. Data Management

### 4.1 Local Storage

*   **Persistent Data:**
    *   Connection settings
    *   UI preferences
    *   Authentication tokens
    *   Recent conversations list

*   **Cache:**
    *   File content cache
    *   Conversation history cache
    *   Command history

### 4.2 State Synchronization

*   **Client-Server State:**
    *   Track conversation state version
    *   Handle conflicts in concurrent edits
    *   Recover from divergent states

*   **Offline Support (Future):**
    *   Queue actions when offline
    *   Sync when connection restored

## 5. Error Handling

### 5.1 Error Categories

*   **Connection Errors:**
    *   Failed initial connection
    *   Connection lost during session
    *   Authentication failures

*   **API Errors:**
    *   Invalid requests
    *   Server-side errors
    *   Rate limiting

*   **Runtime Errors:**
    *   Invalid state transitions
    *   Resource limitations
    *   Unexpected responses

### 5.2 Recovery Strategies

*   **Automatic Recovery:**
    *   Reconnection attempts
    *   Request retries with backoff
    *   State resynchronization

*   **User-Guided Recovery:**
    *   Clear error messages
    *   Actionable recovery options
    *   Graceful degradation

## 6. Performance Considerations

*   **Large Output Handling:**
    *   Chunked processing
    *   Virtualized list views
    *   Efficient rendering of complex outputs

*   **Memory Management:**
    *   Cache size limitations
    *   Resource cleanup
    *   Background processing for intensive operations

*   **Responsiveness:**
    *   Non-blocking UI during network operations
    *   Progress indicators for long-running tasks
    *   Cancelable operations where possible

## 7. Compatibility Requirements

*   **Backend Compatibility:**
    *   Support for current OpenHands backend API
    *   Graceful handling of unknown event types
    *   Feature detection for optional capabilities

*   **macOS Compatibility:**
    *   Target current stable macOS release
    *   SwiftUI compatibility considerations
    *   System integration (notifications, etc.)

## 8. MVP Scope and Priorities

### 8.1 Must-Have Features (MVP)

1.  Basic task input and submission
2.  Agent output display with formatting
3.  Read-only file explorer
4.  Start/stop agent controls
5.  Comprehensive settings panel with tabbed interface matching all backend config.template.toml options
6.  Basic error handling and recovery
7.  Multiple conversation management with search and filtering
8.  Backend connection configuration
9.  Conversation history and state persistence

### 8.2 Nice-to-Have Features (Post-MVP)

1.  Image attachment in task input
2.  File editing capabilities
3.  Advanced output formatting
4.  Advanced keyboard shortcuts
5.  Offline support
6.  Settings import/export
7.  Advanced customization options
8.  Conversation grouping and tagging
9.  Conversation export functionality
10. Settings profiles management

## 9. Implementation Approach

*   **Architecture:** MVVM with SwiftUI
*   **State Management:** Observable objects with property wrappers
*   **Concurrency:** Swift async/await for asynchronous operations
*   **Networking:** Combine framework for reactive programming
*   **Persistence:** UserDefaults for basic settings, Core Data for more complex data (if needed)
*   **UI Framework:** SwiftUI with minimal UIKit integration where necessary

5.  **Control Buttons:**
    *   Description: Buttons to control the execution of the agent.
    *   Functionality:
        *   Start: Initiate agent execution for the given task.
        *   Stop: Terminate agent execution.
        *   Pause/Resume: (Optional for initial version) Pause and resume agent execution.
        *   Step: (Optional for initial version) Step through agent actions one by one for debugging/inspection.

6.  **Prompt Configuration Area:**
    *   Description: A section to manage and configure prompts, including system prompts and MicroAgents.
    *   Functionality:
        *   **MicroAgent Source Tabs/Sections:**
            *   **Public MicroAgents:** (View-only) - Browse and view descriptions of public MicroAgents.
            *   **Repo-Specific MicroAgents:** (Editable) - Browse, view, and edit repo-specific MicroAgents.
        *   **MicroAgent List:** Display lists of MicroAgents within each source section.
        *   **MicroAgent Content Editor:**
            *   View and edit (for repo-specific) the content of selected MicroAgents (Markdown/YAML editor with syntax highlighting).
            *   View (for public MicroAgents) the content of selected MicroAgents (view-only editor).
        *   **(Optional) Version Control/Undo-Redo for Repo-Specific MicroAgents:** Basic undo/redo functionality in the editor.

7.  **Memory Area:**
    *   Description: A section to visualize and potentially manage the agent's memory (short-term and long-term).
    *   Functionality:
        *   **Memory Display:** Visualize agent's memory content (format to be determined - e.g., text, graph).
        *   **(Optional) Memory Management:** Features to clear or edit memory (for advanced users).

## 2. Interface Structure

The UI structure is conceptually divided into two main columns: a left column for the Chat Area and a right column for context and tools.

```
+-----------------------------------------------------+-----------------------------------------------------------------------+
|                      Left Column                      |                             Right Column                              |
| +-------------------------------------------------+ | +-------------------------------------------------------------------+ |
| |                  Chat Area                      | | |                      Top Right Section                            | |
| | +---------------------------------------------+ | | | | +---------------------------------------+-----------------------+ |
| | |          Agent Output Display             | | | | | |    Workspace (File Explorer)       | Variable Context Area   | |
| | | (Conversation History, Agent Actions, Logs) | | | | | |                                       | (Settings,         | |
| | +---------------------------------------------+ | | | | |                                       |  Prompts,    | |
| | |              User Input Area                | | | | |                                       |  Memory - switchable)  | |
| | |         (User Input Area)              | | | | +---------------------------------------+-----------------------+ |
| | +---------------------------------------------+ | | +-------------------------------------------------------------------+ |
| +-------------------------------------------------+ | | |             Bottom Right Section: Terminal/Command Output         | |
|                                                     | | | +-------------------------------------------------------------------+ |
|                                                     | | | |                                                                   | |
|                                                     | | | | (Smaller height than Top Right Section)                           | |
|                                                     | | +-------------------------------------------------------------------+ |
+-----------------------------------------------------+-----------------------------------------------------------------------+
```

*   **Left Column (Chat Area):** Focuses on user interaction and agent communication.
    *   **Agent Output Display:** Shows the conversation history, agent actions, and logs.
    *   **User Input Area:**  Provides a text area for user instructions.

*   **Right Column (Context and Tools):**  Provides supporting information and tools, split horizontally.
    *   **Top Right Section:** Split vertically into two areas.
        *   **Workspace (File Explorer):** Displays a file tree for workspace navigation.
        *   **Variable Context Area:** Switchable tabbed panel for different context views. The views available in this area are:
            *   **Settings Panel:**  For configuring application settings.
            *   **Prompt Configuration Area:** For managing system prompts and MicroAgents.
            *   **Memory Area:** To visualize and manage the agent's memory.
    *   **Bottom Right Section: Terminal/Command Output:** Displays the output of commands executed by the agent.  This section has a smaller height than the Top Right Section.

